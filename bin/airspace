#!/usr/bin/env node
var fs = require('fs');
var os = require('os');
var path = require('path');
var spawn = require('child_process').spawn;

var NodeWebkitVersion = JSON.parse(fs.readFileSync(path.join(__dirname, '..', 'package.json'), 'utf-8')).nwVersion;
var workingDir = path.dirname(__dirname);
var platformSuffixes = {
  win32:  'win-ia32/nw.exe',
  darwin: 'osx-ia32/node-webkit.app/Contents/MacOS/node-webkit',
  linux:  'linux-ia32/nw'
};

process.env.LEAPHOME_ENV = process.env.LEAPHOME_ENV || 'development';

var executable = 'nw/node-webkit-v' + NodeWebkitVersion + '-' + platformSuffixes[os.platform()];
var nw = spawn(executable, [ '.' ].concat(process.argv.slice(2)), {
  cwd: workingDir,
  env: process.env
});
nw.stdout.pipe(process.stdout);
nw.stderr.pipe(process.stderr);
nw.on('exit', function(code) {
  process.exit(code);
});

function killNodeWebkit() {
  nw.kill();
}
process.on('SIGINT', killNodeWebkit);
process.on('SIGTERM', killNodeWebkit);
